"use strict";function eachActiveConnection(e){var o=$(".active"),t={};o.each(function(){var o=$(this).attr("id");if(!t[o])for(var n=peer.connections[o],i=0,a=n.length;a>i;i+=1){var c=n[i];e(c,$(this))}t[o]=1})}var localMediaStream;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var peer=new Peer({key:"x7fwx2kavpy6tj4i",debug:3});peer.on("open",function(e){var o=$("#pid");o.text(e);var t=$("<a>Tweet</a>");t.attr({href:"https://twitter.com/share","class":"twitter-share-button","data-lang":"ja","data-count":"none","data-url":location.href+"?id="+e,"data-text":"THETA S Live Streaming"}),o.after(t),twttr.widgets.load()}),peer.on("error",function(e){console.log(e)}),$("#connect").click(function(){var e=$("#rid").val();peer.connect(e),peer.on("call",function(e){e.answer(),e.on("stream",function(e){console.log("recived stream from host"),"undefined"!=typeof video.mozSrcObject?video.mozSrcObject=e:video.src=window.URL&&window.URL.createObjectURL(e)||e,video.play()})})}),$("#host").click(function(){if(navigator.getUserMedia){var e=navigator.mediaDevices.getUserMedia({video:!0});e.then(function(e){"undefined"!=typeof video.mozSrcObject?video.mozSrcObject=e:video.src=window.URL&&window.URL.createObjectURL(e)||e,localMediaStream=e,console.log("get localMedia"),$("#client").hide(),$("#connected-list").show(),video.play(),peer.on("connection",function(e){console.log("get connection from client("+e.peer+")"),$("#connected").append('<li class="list-group-item">'+e.peer+"</li>"),peer.call(e.peer,localMediaStream)})}),e["catch"](function(e){console.log(e.name)})}else console.log("getUserMedia not supported")}),$("#close").click(function(){eachActiveConnection(function(e){e.close()})}),$(window).on("load",function(){$("#connected-list").hide();var e=$.url(),o=e.param("id");$("#rid").val(o)}),$(window).on("unload beforeunload",function(e){peer&&!peer.destroyed&&peer.destroy()});