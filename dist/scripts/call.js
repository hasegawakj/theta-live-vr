"use strict";function eachActiveConnection(e){var o=$(".active"),n={};o.each(function(){var o=$(this).attr("id");if(!n[o])for(var i=peer.connections[o],t=0,c=i.length;c>t;t+=1){var r=i[t];e(r,$(this))}n[o]=1})}var localMediaStream;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var peer=new Peer({key:"x7fwx2kavpy6tj4i",debug:3});peer.on("open",function(e){$("#pid").text(e)}),peer.on("error",function(e){console.log(e)}),$("#connect").click(function(){var e=$("#rid").val();peer.connect(e),peer.on("call",function(e){e.answer(),e.on("stream",function(e){console.log("recived stream from host"),"undefined"!=typeof video.mozSrcObject?video.mozSrcObject=e:video.src=window.URL&&window.URL.createObjectURL(e)||e,video.play()})})}),$("#host").click(function(){if(navigator.getUserMedia){var e=navigator.mediaDevices.getUserMedia({video:!0});e.then(function(e){"undefined"!=typeof video.mozSrcObject?video.mozSrcObject=e:video.src=window.URL&&window.URL.createObjectURL(e)||e,localMediaStream=e,console.log("get localMedia"),$("#client").hide(),video.play(),peer.on("connection",function(e){console.log("get connection from client("+e.peer+")"),$("#connected").append('<li class="list-group-item">'+e.peer+"</li>"),peer.call(e.peer,localMediaStream)})}),e["catch"](function(e){console.log(e.name)})}else console.log("getUserMedia not supported")}),$("#close").click(function(){eachActiveConnection(function(e){e.close()})}),window.onunload=window.onbeforeunload=function(e){peer&&!peer.destroyed&&peer.destroy()};